<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>**Linaro Automated Validation Architecture**</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="8hz0" id="linaro-automated-validation-architecture"><strong>Linaro Automated Validation Architecture</strong></h1><p data-anchor-id="wyf4"><code>LAVA</code> <code>Installation</code> <code>Configuration</code></p><hr><div class="md-section-divider"></div><h2 data-anchor-id="tzv4" id="1-whats-is-lava"><strong>1 What's is LAVA</strong>？</h2><p data-anchor-id="mks4">LAVA is the Linaro Automation and Validation Architecture.</p><p data-anchor-id="sdko">LAVA is a continuos integration system for deploying operationg systems onto physical and virtual hardware for running tests. Tests can be simple boot testing, bootloader testing and system level testing, although extra hardware may be required for some system tests. It could be a simple compile or boot test for the kernel, testing whether the code produced by gcc is smaller of faster, whether a kernel scheduler change reduces power consumption for a certain workload, or many other things.</p><p data-anchor-id="lpm8">For more information, please refer to <a href="https://validation.linaro.org/static/docs/overview.html#what-is-lava" target="_blank">https://validation.linaro.org/static/docs/overview.html#what-is-lava</a></p><p data-anchor-id="sgl6"><font color="red"><strong>LAVA Architecture:</strong></font></p><p data-anchor-id="sv8d"><img src="http://static.zybuluo.com/wangbo/6m3k3uz4486esfftv8yft76m/LAVA.png" alt="LAVA Architecture" title=""></p><p data-anchor-id="atc9"><font color="red"><strong>LAVA Components:</strong></font></p><blockquote data-anchor-id="lxhi" class="white-blockquote">
  <ul>
  <li><strong>Driver</strong> <br>
  <ul><li>Receive events from other systems <br>
  <ul><li>Continous integration (jenkins, buildbot, etc)</li>
  <li>Image build system (offspring)</li>
  <li>Android build system</li></ul></li>
  <li>Decide on tests to run based on input stream</li>
  <li>Submit templated jobs to the Scheduler</li></ul></li>
  <li><strong>Scheduler</strong> <br>
  <ul><li>Django app</li>
  <li>Web UI for human job creation</li>
  <li>XML-PRC interface for CLI joband automated job submission</li>
  <li>Support pools of similar hardware, schedule to pool or to a specific device</li>
  <li>Scheduler Daemon, Process job queue/Launch dispatchers/Handle job (in) completion/Handle job timeout</li></ul></li>
  <li><strong>Job Dispatcher</strong> <br>
  <ul><li>Jobs defined in json</li>
  <li>job_name - description of the job</li>
  <li>timeout - how long</li>
  <li>target - which machine to run on</li>
  <li>actions <br>
  <ul><li>deploy_linaro_image, hwpack/rootfs...</li>
  <li>boot_linaro_image</li>
  <li>submit_results, server/stream</li></ul></li></ul></li>
  <li><strong>Results Dashboard</strong> <br>
  <ul><li>Django</li>
  <li>XML-PRC</li>
  <li>well-defined, versioned, JSON bundle submissions</li>
  <li>Basic or OpenID authentication</li>
  <li>Supports text or binary attachments</li>
  <li>Reporting</li></ul></li>
  </ul>
</blockquote><p data-anchor-id="dsu9"><img src="http://static.zybuluo.com/wangbo/ldqmgsx4l86uv14sje34k0dn/LAVA%20workflow.png" alt="LAVA Workflow" title=""></p><hr><div class="md-section-divider"></div><h2 data-anchor-id="i8zi" id="2-installation-single-master-instance"><strong>2 Installation - Single Master Instance</strong></h2><div class="md-section-divider"></div><h3 data-anchor-id="awek" id="21-installation-types"><strong>2.1 Installation Types</strong></h3><blockquote data-anchor-id="hovr" class="white-blockquote">
  <ul>
  <li><strong>Single Master Instance installation</strong> <br>
  A single instance runs the web frontend, the database, the scheduler and the dispatcher on a single machine. If this machine is also running tests, the device (or devices) under test (DUT) will also need to be connected to this machine, possibly over the network, using USB or using serial cables. <br>
  To install a single master instance and create a superuser, refer to <a href="https://validation.linaro.org/static/docs/installing_on_debian.html#debian-installation" target="_blank">Debian-based distributions installation</a>.</li>
  <li><strong>Distributed Instance installation</strong> <br>
  A single master instance, can also work with one Remote Worker or more, acting as the web frontend and database server for the remote worker(s). Depending on load, the master can also have devices attached. <br>
  This installation type involves the use of two or more machines: <br>
  <ul><li>The master instance is installed and configured on one machine. Refer to <a href="https://validation.linaro.org/static/docs/installing_on_debian.html#debian-installation" target="_blank">Debian-based distributions installation</a>.</li>
  <li>On the other machine(s), the Remote Worker is installed and configured. Refer to <a href="https://validation.linaro.org/static/docs/distributed-deployment.html#distributed-deployment" target="_blank">Deploying Distributed Instances</a>. <em>Remote Worker: A dispatcher with devices attached which does not have a web frontend but which uses a connection to a remote lava-server to retrieve the list of jobs for supported boards.</em></li></ul></li>
  </ul>
</blockquote><div class="md-section-divider"></div><h3 data-anchor-id="wjcc" id="22-single-master-instance-installation"><strong>2.2 Single Master Instance installation</strong></h3><p data-anchor-id="yx0m"><font color="red"><strong>Installing on Ubuntu 14.04 LTS:</strong></font></p><p data-anchor-id="ty3u">LAVA recommends the use of Debian - Ubuntu installs are possible but may not receive updates of the LAVA packages. <strong>Ubuntu Unicorn 14.10 includes all packages needed by LAVA up to the 2014.07 release.</strong> Subsequent releases of Ubuntu will contain newer versions of LAVA and LAVA dependencies.</p><pre data-anchor-id="jh4b"><code>Note: Only 64bit installations are supported for Ubuntu Trusty 14.04 LTS and not all production hot fixes may actually get uploaded to the repository.
</code></pre><p data-anchor-id="onos">Updated versions of lava-server and lava-dispatcher can be obtained from:</p><pre data-anchor-id="u052"><code>deb [arch=amd64] http://images.validation.linaro.org/trusty-repo trusty main
deb http://ppa.launchpad.net/linaro-maintainers/tools/ubuntu precise main
</code></pre><p data-anchor-id="p8ji">This repository is <strong>not a Ubuntu PPA</strong> - it has to be set up manually by adding a file to <code>/etc/apt/sources.list.d/</code> and adding the key to apt-key.</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="27uc"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">wget http</span><span class="pun">:</span><span class="com">//images.validation.linaro.org/trusty-repo/trusty-repo.key.asc</span></code></li><li class="L1"><code class="language-shell"><span class="pln">sudo apt</span><span class="pun">-</span><span class="pln">key add trusty</span><span class="pun">-</span><span class="pln">repo</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">asc</span></code></li><li class="L2"><code class="language-shell"><span class="pln">wget http</span><span class="pun">:</span><span class="com">//images.validation.linaro.org/staging-repo/staging-repo.key.asc</span></code></li><li class="L3"><code class="language-shell"><span class="pln">sudo apt</span><span class="pun">-</span><span class="pln">key add staging</span><span class="pun">-</span><span class="pln">repo</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">asc</span></code></li><li class="L4"><code class="language-shell"><span class="pln">sudo apt</span><span class="pun">-</span><span class="kwd">get</span><span class="pln"> update</span></code></li></ol></pre><ul data-anchor-id="ld6v">
<li><p><strong>Installing just lava-server</strong> <br>
The <code>lava-server</code> package is the main LAVA scheduler and fronted. To install just lava-server from the current packages, use:</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">sudo apt</span><span class="pun">-</span><span class="kwd">get</span><span class="pln"> install lava</span><span class="pun">-</span><span class="pln">server</span></code></li><li class="L1"><code class="language-shell"><span class="pln">sudo a2dissite </span><span class="lit">000</span><span class="pun">-</span><span class="kwd">default</span></code></li><li class="L2"><code class="language-shell"><span class="pln">sudo a2ensite lava</span><span class="pun">-</span><span class="pln">server</span><span class="pun">.</span><span class="pln">conf</span></code></li><li class="L3"><code class="language-shell"><span class="pln">sudo service apache2 restart</span></code></li></ol></pre>

<blockquote class="white-blockquote">
  <p>This will install lava-dispatcher and lava-server. Other packages to consider:</p>
  
  <ul><li><code>lavapdu-client</code> to control a PDU to allow LAVA to automatically power cycle a device.</li>
  <li><code>lava-daemon</code> only one daemon is required to run multiple PDUs.</li>
  <li><code>ntp</code> some actions within LAVA can be time-sensitive, so ensuring that devices within your lab keep time correctly can be important.</li>
  <li>linaro-image-tools which provides <code>linaro-media-create</code> for tests which use hardware packs from Linaro.</li></ul>
</blockquote></li>
<li><p><strong>Installing the full lava set</strong> <br>
Production installs of LAVA will rarely use the full lava set as it includes tools more commonly used by developers and test labs. These tools mean that the lava package brings more dependencies than when installing <code>lava-server</code> to run a production LAVA instance.</p>

<blockquote class="white-blockquote">
  <p>The lava packages support for:</p>
  
  <ul><li><code>lava-dev</code> scripts to build developer packages based on your current git tree of lava-server or lava-dispatcher, including any local changes.</li>
  <li>linaro-image-tools which provides <code>linaro-media-create</code> for tests which use hardware packs from Linaro.</li>
  <li><code>vmdebootstrap</code> for building your own Debian based KVM images.</li>
  <li><code>lavapdu-client</code> to control a PDU to allow LAVA to automatically power cycle a device.</li>
  <li><code>lavapdu-daemon</code> is recommended or you can use a single daemon for multiple PDUs.</li>
  <li><code>ntp</code> some actions within LAVA can be time-sensitive, so ensuring that devices within your lab keep time correctly can be important.</li></ul>
  
  <p>All of these packages can be installed separately alongside the main lava-server package, the lava package merely collects them into one set.</p>
</blockquote>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">sudo apt</span><span class="pun">-</span><span class="kwd">get</span><span class="pln"> install postgresql</span></code></li><li class="L1"><code class="language-shell"><span class="pln">sudo apt</span><span class="pun">-</span><span class="kwd">get</span><span class="pln"> install lava</span></code></li></ol></pre>

<ol><li><p>Choose a standalone master instance of LAVA <code>&lt;Yes&gt;</code> <br>
<img src="http://static.zybuluo.com/wangbo/lfpc88jvb0z0cpuzw9u8qcpn/QQ%E6%88%AA%E5%9B%BE20151229162436.png" alt="single_1" title=""></p></li>
<li><p>Set name for this LAVA instance <br>
<img src="http://static.zybuluo.com/wangbo/ebazbqxikoha6rm1ii887y4o/QQ%E6%88%AA%E5%9B%BE20151229163046.png" alt="single_2" title=""></p></li>
<li><p>Port number of the PostgreSQL database <br>
<img src="http://static.zybuluo.com/wangbo/wkhl1altjs4njvi5mvfwg6x5/QQ%E6%88%AA%E5%9B%BE20151229163536.png" alt="single_3" title=""></p></li>
<li><p>Name for this LAVA instance <br>
<img src="http://static.zybuluo.com/wangbo/ge2prupo0o6gg31oulrj2lkz/QQ%E6%88%AA%E5%9B%BE20151229163838.png" alt="single_4" title=""></p></li>
<li><p>Hostname of your system <br>
<img src="http://static.zybuluo.com/wangbo/ys2upi66u8aalc1pgec1q21w/QQ%E6%88%AA%E5%9B%BE20151229164003.png" alt="single_5" title=""></p></li>
<li><p>Configure nullmailer <br>
<img src="http://static.zybuluo.com/wangbo/p3aoy5vcjbl4vd27ppebyoau/QQ%E6%88%AA%E5%9B%BE20151229164341.png" alt="single_6" title=""> <br>
<img src="http://static.zybuluo.com/wangbo/80r115p0zitfm5t7ccjfluzy/QQ%E6%88%AA%E5%9B%BE20151229164627.png" alt="single_7" title=""></p></li>
<li><p>Configure apache2 <code>/etc/apache2/sites-available/</code></p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">sudo a2dissite </span><span class="lit">000</span><span class="pun">-</span><span class="kwd">default</span></code></li><li class="L1"><code class="language-shell"><span class="pln">sudo a2ensite lava</span><span class="pun">-</span><span class="pln">server</span><span class="pun">.</span><span class="pln">conf</span></code></li><li class="L2"><code class="language-shell"><span class="pln">sudo service apache2 restart</span></code></li></ol></pre></li>
<li><p>Open your Browser (Chrome), input <code>localhost</code> or <code>127.0.0.1</code> <br>
<img src="http://static.zybuluo.com/wangbo/k7vx2pkg8luzodi07qc222kn/QQ%E6%88%AA%E5%9B%BE20151229165427.png" alt="single_8" title=""></p></li></ol></li>
</ul><div class="md-section-divider"></div><h3 data-anchor-id="ii92" id="23-configuration"><strong>2.3 Configuration</strong></h3><p data-anchor-id="07be">In step 8, when we want to click the button like <code>Dashboard</code>, <code>Results</code>, <code>Scheduler</code>, <code>API</code>, there's no reaction, so something wrong with this website. From the log, we can see that <code>404 Not Found</code> error occurs when downloading /lava-server/js/bootstrap-3.1.1.min.js. <br>
<img src="http://static.zybuluo.com/wangbo/3tgvgt2958x6dr4rt16df07r/QQ%E6%88%AA%E5%9B%BE20151229165924.png" alt="single_9" title=""></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="e9ci"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">cd </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">python2</span><span class="pun">.</span><span class="lit">7</span><span class="pun">/</span><span class="pln">dist</span><span class="pun">-</span><span class="pln">packages</span><span class="pun">/</span><span class="pln">lava_server</span><span class="pun">/</span><span class="pln">lava</span><span class="pun">-</span><span class="pln">server</span><span class="pun">/</span><span class="pln">js</span><span class="pun">/</span></code></li><li class="L1"><code class="language-shell"><span class="pln">ls</span></code></li></ol></pre><p data-anchor-id="nmav">And no bootstrap-3.1.1.min.js exists, so we should add this js file to this directory. You can download this file from <a href="https://github.com/ConanGit/LAVA/blob/master/bootstrap/bootstrap-3.1.1.min.js" target="_blank">bootstrap-3.1.1.min.js</a>, and then copy it to /usr/lib/python2.7/dist-packages/lava_server/lava-server/js/.</p><ul data-anchor-id="6ajw">
<li><p><strong>Add user account</strong></p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">sudo lava</span><span class="pun">-</span><span class="pln">server manage createsuperuser </span><span class="pun">--</span><span class="pln">username </span><span class="pun">{</span><span class="pln">username</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">email</span><span class="pun">={</span><span class="pln">email</span><span class="pun">}</span></code></li></ol></pre>

<p>We can use this username &amp; password to login LAVA website. For more details, please refer to <a href="https://validation.linaro.org/static/docs/installing_on_debian.html#lava-archive-signing-key" target="_blank">Local Django Account</a>.</p></li>
<li><p><strong>Adding a KVM device to LAVA</strong></p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">sudo </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">share</span><span class="pun">/</span><span class="pln">lava</span><span class="pun">-</span><span class="pln">server</span><span class="pun">/</span><span class="pln">add_device</span><span class="pun">.</span><span class="pln">py kvm kvm01</span></code></li></ol></pre>

<p>Then generate a conf file in /etc/lava-dispatcher/devices/ named kvm01.conf, you can view this device on <a href="http://localhost/scheduler/device/kvm01" target="_blank">http://localhost/scheduler/device/kvm01</a> or <a href="http://localhost/scheduler/device_type/kvm" target="_blank">http://localhost/scheduler/device_type/kvm</a>.</p></li>
<li><p><strong>Setup a bundle stream</strong></p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">lava</span><span class="pun">-</span><span class="pln">tool make</span><span class="pun">-</span><span class="pln">stream </span><span class="pun">--</span><span class="pln">dashboard</span><span class="pun">-</span><span class="pln">url</span><span class="pun">=</span><span class="pln">http</span><span class="pun">:</span><span class="com">//localhost/RPC2/ /anonymous/{username}/</span></code></li></ol></pre>

<p>Then generate url <a href="http://localhost/dashboard/streams/anonymous/" target="_blank">http://localhost/dashboard/streams/anonymous/</a>{username}/bundles/, bundle stream is something like one folder, with which we can manage all the test results.</p></li>
<li><p><strong>Submit job</strong> <br>
We can submit job through <a href="http://localhost/scheduler/jobsubmit" target="_blank">http://localhost/scheduler/jobsubmit</a>. A job defines what image to deploy on the DUT and further actions that should be performed on the DUT. Jobs are defined in JSON files. <br>
Job definition:</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-json"><span class="pun">{</span></code></li><li class="L1"><code class="language-json"><span class="pln">  </span><span class="str">"job_name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"kvm-test"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-json"><span class="pln">  </span><span class="str">"device_type"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"kvm"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-json"><span class="pln">  </span><span class="str">"timeout"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1800</span><span class="pun">,</span></code></li><li class="L4"><code class="language-json"><span class="pln">  </span><span class="str">"actions"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L5"><code class="language-json"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L6"><code class="language-json"><span class="pln">      </span><span class="str">"command"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"deploy_linaro_image"</span><span class="pun">,</span></code></li><li class="L7"><code class="language-json"><span class="pln">      </span><span class="str">"parameters"</span><span class="pun">:</span></code></li><li class="L8"><code class="language-json"><span class="pln">        </span><span class="pun">{</span></code></li><li class="L9"><code class="language-json"><span class="pln">          </span><span class="str">"image"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"http://images.validation.linaro.org/kvm-debian-wheezy.img.gz"</span></code></li><li class="L0"><code class="language-json"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1"><code class="language-json"><span class="pln">    </span><span class="pun">},</span></code></li><li class="L2"><code class="language-json"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L3"><code class="language-json"><span class="pln">      </span><span class="str">"command"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"boot_linaro_image"</span></code></li><li class="L4"><code class="language-json"><span class="pln">    </span><span class="pun">},</span></code></li><li class="L5"><code class="language-json"><span class="pln">  </span><span class="pun">{</span></code></li><li class="L6"><code class="language-json"><span class="pln">    </span><span class="str">"command"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"submit_results"</span><span class="pun">,</span></code></li><li class="L7"><code class="language-json"><span class="pln">    </span><span class="str">"parameters"</span><span class="pun">:</span></code></li><li class="L8"><code class="language-json"><span class="pln">      </span><span class="pun">{</span></code></li><li class="L9"><code class="language-json"><span class="pln">        </span><span class="str">"server"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"http://localhost/RPC2/"</span><span class="pun">,</span></code></li><li class="L0"><code class="language-json"><span class="pln">        </span><span class="str">"stream"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"/anonymous/{username}/"</span></code></li><li class="L1"><code class="language-json"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L2"><code class="language-json"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L3"><code class="language-json"><span class="pln"> </span><span class="pun">]</span></code></li><li class="L4"><code class="language-json"><span class="pun">}</span></code></li></ol></pre>

<p>Please replace the {username} in json to username you defined in bundle stream. <br>
Add <code>root_part = 1</code> line to the device configuration (kvm01.conf).</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">sudo gedit </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">modules</span><span class="pun">-</span><span class="pln">load</span><span class="pun">.</span><span class="pln">d</span><span class="pun">/</span><span class="pln">lava_modules</span><span class="pun">.</span><span class="pln">conf </span><span class="com"># "enable loop" in lava_modules.conf</span></code></li><li class="L1"><code class="language-shell"><span class="pln">sudo modprobe loop</span></code></li></ol></pre></li>
</ul><p data-anchor-id="tewt">Submit the job, then you can get the execution log in <a href="http://localhost/scheduler/alljobs" target="_blank">http://localhost/scheduler/alljobs</a>.</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="j3fq" id="3-installation-distributed-instance"><strong>3 Installation - Distributed Instance</strong></h2><hr><div class="md-section-divider"></div><h2 data-anchor-id="zn0n" id="4-faq"><strong>4 FAQ</strong></h2><div class="md-section-divider"></div><h3 data-anchor-id="9bb1" id="41-lava-pdu-daemon"><strong>4.1 LAVA PDU Daemon</strong></h3><p data-anchor-id="c5fm">LAVA provides <code>lavapdu</code> to control PDUs (Power Distribution Unit), inclues three modules: <code>pduclient</code> (\usr\bin), <code>lavapdu-listen</code> (\usr\sbin), <code>lavapdu-runner</code> (\sur\sbin).</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="d2hd"><ol class="linenums"><li class="L0"><code class="language-shell"><span class="pln">pduclient </span><span class="pun">--</span><span class="pln">daemon deamonhostname </span><span class="pun">--</span><span class="pln">hostname pduhostname </span><span class="pun">--</span><span class="pln">port pduportnum </span><span class="pun">--</span><span class="pln">command pducommand</span></code></li><li class="L1"><code class="language-shell"><span class="pln">pduclient </span><span class="pun">--</span><span class="pln">daemon localhost </span><span class="pun">--</span><span class="pln">hostname </span><span class="str">'pduhostname/ip'</span><span class="pln"> </span><span class="pun">--</span><span class="pln">port </span><span class="str">'[01|02|03]'</span><span class="pln"> </span><span class="pun">--</span><span class="pln">command </span><span class="str">'[on|off|reboot]'</span></code></li></ol></pre><p data-anchor-id="m2ps">LAVA uses apc PDU in the source code, so we must add driver for our PDU. Here I add a file named np1601 in /usr/lib/python2.7/dist-packages/lava-pdu/drivers/, and  change the corresponding lines in the other files.</p><p data-anchor-id="5mwe">You can get the latest PDU files from <a href="https://github.com/ConanGit/LAVA.git" target="_blank">Git</a>, I add driver file for NP1601, replace apcbase.py and strategies.py. But the code of PDU Daemon of Ubuntu is not really better than Debian, we can modify it later.</p><p data-anchor-id="iusd">Modify the configuration of <code>lavapdu</code>, add below lines to \etc\lavapdu\lavapdu.conf. <code>pduhostname/ip</code> is your PDU hostname or ip address, <code>username</code> is the username of PDU, and <code>password</code> is in the same way.</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="fkve"><ol class="linenums"><li class="L0"><code class="language-json"><span class="str">"pduhostname/ip"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-json"><span class="pln">    </span><span class="str">"driver"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"np1601"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-json"><span class="pln">    </span><span class="str">"telnetport"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">23</span><span class="pun">,</span></code></li><li class="L3"><code class="language-json"><span class="pln">    </span><span class="str">"username"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"admin"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-json"><span class="pln">    </span><span class="str">"password"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"admin"</span></code></li><li class="L5"><code class="language-json"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="ec1f">Then you can use <code>pduclient</code> to control the remote PDU.</p><div class="md-section-divider"></div><h3 data-anchor-id="uad2" id="42-install-tftp-telnet-ssh"><strong>4.2 Install tftp, telnet, ssh</strong></h3><ul data-anchor-id="go4f">
<li><p><strong>tftp</strong></p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-bash"><span class="pln">sudo apt</span><span class="pun">-</span><span class="pln">get install tftpd</span><span class="pun">-</span><span class="pln">hpa tftp</span><span class="pun">-</span><span class="pln">hpa</span></code></li><li class="L1"><code class="language-bash"><span class="pln">sudo mkdir </span><span class="pun">/</span><span class="pln">tftp </span><span class="com"># share folder</span></code></li><li class="L2"><code class="language-bash"><span class="pln">sudo chmod </span><span class="pun">-</span><span class="pln">R </span><span class="lit">0777</span><span class="pln"> </span><span class="pun">/</span><span class="pln">tftp</span></code></li><li class="L3"><code class="language-bash"><span class="pln">sudo gedit </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">default</span><span class="pun">/</span><span class="pln">tftp</span><span class="pun">-</span><span class="pln">hpa</span></code></li><li class="L4"><code class="language-bash"><span class="pln">    </span><span class="pun">[</span><span class="kwd">set</span><span class="pln"> TFTP_DIRECTORY </span><span class="pun">=</span><span class="pln"> </span><span class="str">"/tftp"</span><span class="pun">]</span></code></li><li class="L5"><code class="language-bash"><span class="pln">    </span><span class="pun">[</span><span class="kwd">set</span><span class="pln"> TFTP_OPTIONS </span><span class="pun">=</span><span class="pln"> </span><span class="str">"-l -c -s"</span><span class="pun">]</span></code></li><li class="L6"><code class="language-bash"><span class="pln">sudo service tftpd</span><span class="pun">-</span><span class="pln">hpa restart</span></code></li><li class="L7"><code class="language-bash"><span class="pln">cd </span><span class="pun">/</span><span class="pln">tftp</span></code></li><li class="L8"><code class="language-bash"><span class="pln">touch test</span><span class="pun">.</span><span class="pln">txt</span></code></li><li class="L9"><code class="language-bash"><span class="pln">cd </span><span class="pun">~</span></code></li><li class="L0"><code class="language-bash"><span class="pln">tftp localhost</span></code></li><li class="L1"><code class="language-bash"><span class="pln">    tftp</span><span class="pun">&gt;</span><span class="pln"> get test</span><span class="pun">.</span><span class="pln">txt</span></code></li><li class="L2"><code class="language-bash"><span class="pln">    tftp</span><span class="pun">&gt;</span><span class="pln"> q</span></code></li><li class="L3"><code class="language-bash"><span class="pln">ls test</span><span class="pun">.</span><span class="pln">txt</span></code></li></ol></pre></li>
<li><p><strong>telnet</strong></p></li>
<li><p><strong>ssh</strong></p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-bash"><span class="pln">sudo apt</span><span class="pun">-</span><span class="pln">get install openssh</span><span class="pun">-</span><span class="pln">server </span></code></li></ol></pre></li>
</ul></div>
</body>
</html>